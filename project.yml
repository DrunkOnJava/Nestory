name: Nestory
options:
  bundleIdPrefix: com.drunkonjava.nestory
  deploymentTarget:
    iOS: 17.0
  developmentLanguage: en
  xcodeVersion: 15.0
  createIntermediateGroups: true
  generateEmptyDirectories: true

attributes:
  ORGANIZATIONNAME: Nestory
  DEVELOPMENT_TEAM: 2VXBQV4XC9

configs:
  Debug:
    xcconfig: Config/Debug.xcconfig
  Release:
    xcconfig: Config/Release.xcconfig

settings:
  base:
    IPHONEOS_DEPLOYMENT_TARGET: 17.0
    SWIFT_VERSION: 6.0
    DEVELOPMENT_TEAM: 2VXBQV4XC9
    CODE_SIGN_STYLE: Automatic
    CURRENT_PROJECT_VERSION: 4
    MARKETING_VERSION: 1.0.1
    ENABLE_BITCODE: NO
    DEBUG_INFORMATION_FORMAT: dwarf-with-dsym
    ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
  configs:
    Debug:
      SWIFT_STRICT_CONCURRENCY: minimal
      SWIFT_TREAT_WARNINGS_AS_ERRORS: NO
      OTHER_SWIFT_FLAGS: "-Xfrontend -disable-availability-checking -suppress-warnings"
      DEBUG_INFORMATION_FORMAT: dwarf-with-dsym
    Release:
      SWIFT_STRICT_CONCURRENCY: complete
      DEBUG_INFORMATION_FORMAT: dwarf-with-dsym

packages: {}

targets:
  Nestory:
    type: application
    platform: iOS
    deploymentTarget: 17.0
    
    sources:
      - path: App-Main
        excludes:
          - "RootFeature.swift"
          - "RootView.swift"
          - "SearchView-Old.swift"
      - path: Foundation/Models
      - path: Foundation/Core
      - path: Foundation/Utils
      - path: Infrastructure/Storage
      - path: Infrastructure/Cache
      - path: Infrastructure/Camera
      - path: Infrastructure/Security
      - path: Infrastructure/Actors
      - path: Infrastructure/Network
      - path: Infrastructure/Monitoring
      - path: Infrastructure/HotReload
        excludes:
          - "*.swift"
      - path: Services
      - path: Services/BarcodeScannerService
      - path: Services/CloudBackupService
      - path: Services/ImportExportService
      - path: Services/InsuranceExport
      - path: Services/InsuranceReport
      - path: Services/NotificationService
      - path: Services/ReceiptOCR
      - path: UI/UI-Core
      - path: UI/UI-Components
      - path: Config/FeatureFlags.swift
      - path: Config/EnvironmentConfiguration.swift
      
    resources:
      - path: App-Main/Assets.xcassets
        buildPhase: resources
      - path: App-Main/Preview Content/PreviewAssets.xcassets
        buildPhase: resources
        
    settings:
      base:
        PRODUCT_NAME: Nestory
        PRODUCT_BUNDLE_IDENTIFIER: com.drunkonjava.nestory.dev
        INFOPLIST_FILE: App-Main/Info.plist
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_INCLUDE_ALL_APPICON_ASSETS: YES
        ENABLE_PREVIEWS: YES
        SWIFT_UPCOMING_FEATURE_CONCURRENCY: YES
        SWIFT_UPCOMING_FEATURE_EXISTENTIAL_ANY: YES
        
    dependencies:
      - sdk: SwiftData.framework
      - sdk: CloudKit.framework

  NestoryUITests:
    type: bundle.ui-testing
    platform: iOS
    deploymentTarget: 17.0
    sources:
      - NestoryUITests
    dependencies:
      - target: Nestory
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.drunkonjava.nestory.UITests
        TEST_TARGET_NAME: Nestory
        GENERATE_INFOPLIST_FILE: YES
        SWIFT_VERSION: 6.0
        SWIFT_STRICT_CONCURRENCY: minimal
        SWIFT_TREAT_WARNINGS_AS_ERRORS: NO

schemes:
  Nestory-Dev:
    build:
      targets:
        Nestory: all
    run:
      config: Debug
      environmentVariables:
        CLOUDKIT_CONTAINER: iCloud.com.drunkonjava.nestory.dev
        NESTORY_ENVIRONMENT: development
        API_BASE_URL: https://api-dev.nestory.app
        FX_API_ENDPOINT: https://fx-dev.nestory.app
    test:
      config: Debug
      targets:
        - NestoryUITests
    profile:
      config: Debug
    analyze:
      config: Debug
    archive:
      config: Release

  Nestory-Prod:
    build:
      targets:
        Nestory: all
    run:
      config: Release
      environmentVariables:
        CLOUDKIT_CONTAINER: iCloud.com.drunkonjava.nestory
        NESTORY_ENVIRONMENT: production
        API_BASE_URL: https://api.nestory.app
        FX_API_ENDPOINT: https://fx.nestory.app
    test:
      config: Release
      targets:
        - NestoryUITests
    profile:
      config: Release
    analyze:
      config: Release
    archive:
      config: Release

  Nestory-Staging:
    build:
      targets:
        Nestory: all
    run:
      config: Release
      environmentVariables:
        CLOUDKIT_CONTAINER: iCloud.com.drunkonjava.nestory.staging
        NESTORY_ENVIRONMENT: staging
        API_BASE_URL: https://api-staging.nestory.app
        FX_API_ENDPOINT: https://fx-staging.nestory.app
    test:
      config: Release
      targets:
        - NestoryUITests
    profile:
      config: Release
    analyze:
      config: Release
    archive:
      config: Release
      