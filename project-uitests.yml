name: Nestory
options:
  bundleIdPrefix: com.nestory
  deploymentTarget:
    iOS: 17.0
  developmentLanguage: en
  xcodeVersion: 15.0
  createIntermediateGroups: true
  generateEmptyDirectories: true

attributes:
  ORGANIZATIONNAME: Nestory
  DEVELOPMENT_TEAM: 2VXBQV4XC9

configs:
  Debug:
    xcconfig: Config/Debug.xcconfig
  Release:
    xcconfig: Config/Release.xcconfig

settings:
  base:
    IPHONEOS_DEPLOYMENT_TARGET: 17.0
    SWIFT_VERSION: 6.0
    DEVELOPMENT_TEAM: 2VXBQV4XC9
    CODE_SIGN_STYLE: Automatic
    CURRENT_PROJECT_VERSION: 1
    MARKETING_VERSION: 1.0.0
  configs:
    Debug:
      SWIFT_STRICT_CONCURRENCY: minimal
      SWIFT_TREAT_WARNINGS_AS_ERRORS: NO
      OTHER_SWIFT_FLAGS: "-Xfrontend -disable-availability-checking -suppress-warnings"
      EMIT_FRONTEND_COMMAND_LINES: YES
    Release:
      SWIFT_STRICT_CONCURRENCY: complete

packages:
  Inject:
    url: https://github.com/krzysztofzablocki/Inject
    from: 1.5.2
  # InjectionNext disabled for UI testing
  # InjectionNext:
  #   url: https://github.com/johnno1962/InjectionNext
  #   from: 1.0.0

targets:
  Nestory:
    type: application
    platform: iOS
    deploymentTarget: 17.0
    
    sources:
      - path: App-Main
        excludes:
          - "RootFeature.swift"
          - "RootView.swift"
          - "SearchView-Old.swift"
      - path: Foundation/Models
      - path: Foundation/Core
      - path: Foundation/Utils
      - path: Infrastructure/Storage
      - path: Infrastructure/Cache
      - path: Infrastructure/Camera
      - path: Infrastructure/Security
      - path: Services
      - path: Services/CloudBackup
      - path: Services/InsuranceExport
      - path: Services/InsuranceReport
      - path: Services/ReceiptOCR
      - path: UI/UI-Core
      - path: UI/UI-Components
      - path: Config/FeatureFlags.swift
      
    resources:
      - path: App-Main/Assets.xcassets
        
    settings:
      base:
        PRODUCT_NAME: Nestory
        PRODUCT_BUNDLE_IDENTIFIER: com.nestory.app.dev
        INFOPLIST_FILE: App-Main/Info.plist
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ENABLE_PREVIEWS: YES
        SWIFT_UPCOMING_FEATURE_CONCURRENCY: YES
        SWIFT_UPCOMING_FEATURE_EXISTENTIAL_ANY: YES
        OTHER_LDFLAGS: -Xlinker -interposable
        
    dependencies:
      - sdk: SwiftData.framework
      - sdk: CloudKit.framework
      - package: Inject
        product: Inject
      # InjectionNext disabled for UI testing
      # - package: InjectionNext
      #   product: InjectionNext

  NestoryUITests:
    type: bundle.ui-testing
    platform: iOS
    deploymentTarget: 17.0
    sources:
      - NestoryUITests
    dependencies:
      - target: Nestory
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.nestory.UITests
        TEST_TARGET_NAME: Nestory
        GENERATE_INFOPLIST_FILE: YES
        SWIFT_VERSION: 6.0
        SWIFT_STRICT_CONCURRENCY: minimal
        SWIFT_TREAT_WARNINGS_AS_ERRORS: NO

schemes:
  Nestory-Dev:
    build:
      targets:
        Nestory: all
    run:
      config: Debug
      environmentVariables:
        CLOUDKIT_CONTAINER: iCloud.com.nestory.app.dev
        INJECTION_DIRECTORIES: /Users/griffin/Projects/Nestory
    test:
      config: Debug
      targets:
        - NestoryUITests
    profile:
      config: Debug
    analyze:
      config: Debug
    archive:
      config: Debug